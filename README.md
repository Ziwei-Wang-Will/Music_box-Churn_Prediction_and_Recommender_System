# Music_Box

<img src="https://github.com/will-zw-wang/Music_box/blob/master/images/music_box_image.jpg" width="960" height="240">

## Project Objectives

X music box is a well-known music player platform and interested in **Churn Prediction and Recommendation**. To help explore this question, they have provided log data containing billions of song play, search, and download records generated by 600K users. 

## Dataset description
- Play log data 
  - 'uid', 'device', 'song_id', 'song_type', 'song_name', 'singer', 'play_time', 'song_length', 'paid_flag', 'date'
- Download log data
  - 'uid', 'device', 'song_id', 'song_name', 'singer', 'paid_flag', 'date'
- Search log data
  - 'uid', 'device', 'time_stamp', 'search_query', 'date'
- [**Raw data samples**](https://github.com/will-zw-wang/Music_box/tree/master/raw_log_data_samples)


## Analysis Structure
1. Data Exploration and Down Sampling by User
2. Data Processing and Feature Engineering with Spark



## Analysis Details

### 1. Data Exploration and Down Sampling by User
- Get user id list and count  
- Remove bots and outliers
  - There were a few ‘uid’ have huge amount of records up to 10^5, we removed these bots and outliers extremely large ‘count’ larger than 99.9 percentile of all ‘count’ value.
- Apply downsampling on uid level 
  - As we had nearly 1.5 billion records generated by 600K users after moving the bots and outliers, we performed downsampling on ‘uid’ level to reduce computing pressure. 
  - Down_sample_ratio was 0.1 and finally we had records generated by 60K users with 12 million log records. 
  - 12 million log records including:
    - 0.6 million 'D' log records, ‘D’ for ‘download’.
    - 0.8 million 'S' log records, ‘S’ for ‘search’.
    - 0.6 million 'P' log records, ‘P’ for ‘play’.
- Create event table for feature generation  
- [**Detailed Code**](https://github.com/will-zw-wang/Music_box/blob/master/code/3_down_sampling_by_user.ipynb)

### 2. Data Processing and Feature Engineering with Spark
- Label definition
  - We defined churn and time windows as below:
    - 1 for churn: user had P/D/S entries in 'Feature window' while had no P/D/S entries in 'Label window'
    - 0 for not churn: user had P/D/S entries in both two windows
    - Label window: 2017-04-29 ~ 2017-05-12 days: 14
    - Feature window: 2017-03-30 ~ 2017-04-28 days: 30
    - **Note**: here we ignored user who had P/D/S entries in 'Label window' while had no P/D/S entries in 'Feature window'.
  - we have 36,272 churn label and 22,160 active label, two classes were comparable.
- Data cleaning
  - Data processing of "song_length" 
  - Data cleaning for "play_time"
- Feature generation
  - Generate Features A: Play time percentage related features
    - Generate Features **Proportion features of different level of play time percentage**


